(function(r){var v=LIModules.requires("i18n"),c=r.__internal__,l=c.Injector,f=l.dependencies.Helpers,w=c.Request,s=l.dependencies.WebTracking;l.register("NavInboxDropdown",function(c){function x(){n=new l.dependencies.AjaxRequestQueue;p.addEventListener(y,z)}function z(a){var b=a.target;a.preventDefault();if(b.getAttribute(g.ACTION)){a=!1;var c=f.closestAncestorWithClass(b,e.INBOX_ITEM),k=b.getAttribute(g.ACTION),t=b.getAttribute(g.ACTION_URL);if(c.classList.contains(e.MESSAGE_ITEM)){var h=[];"undefined"!==
typeof s&&(h.push("action:"+k),h.push("type:messages"),h.push("folder:received"),s.trackUserAction("list_view-item_action",h.join("|"),!0));t&&(A(c,k,t),a=!0)}if(a)return!1;m(b)}else b.hasAttribute("href")?m(b):b.classList.contains("photo")?(b=b.parentNode,m(b)):(a=b.querySelector("a.detail-link[href]"),a||(b=(b=f.closestAncestorWithClass(b,e.INBOX_ITEM_WONTON)||f.closestAncestorWithClass(b,e.INBOX_ITEM))&&b.getElementsByClassName("detail-link"))&&(a=b[0]),a&&m(a))}function m(a){if(a=a.getAttribute("href"))f.redirectToUrl(a);
else throw Error("Target element has no href");}function A(a,b,c){var k=q.messages;b=document.createElement("div");var g=a.parentNode,h=a.classList;n.enqueue({url:B(c)}).done(function(){k.backfill?n.enqueue({url:k.backfillUrl,dataType:"json",data:{sinceDate:k.sinceDate,startRow:3,count:1,subFilter:"none",sortBy:"DATE",keywords:"",ctx:"nav"}}).done(function(b){var c,d;d=document.createElement("div");d.innerHTML=b.content;b=d.querySelector("."+e.TOTAL_COUNT);c=d.querySelector("."+e.SINCE_DATE);parseInt(b&&
b.innerHTML,10);c=parseInt(c&&c.innerHTML,10);d=d.querySelectorAll("."+e.INBOX_ITEM);b=null;q.messages.sinceDate=c;if(h.contains(e.UNREAD)){c=u;var f=parseInt(C?c.textContent:c.innerText,10)+-1;c.innerHTML=f;r.inbox.updateNavBadge(Math.abs(-1))}0===d.length?k.backfill=!1:b=d[0];g.removeChild(a);b&&(d=b,p.querySelector("."+e.INBOX_LIST).appendChild(d))}):g.removeChild(a)});b.classList.add("submitting");b.innerHTML=v.get("InboxPendingInvitationListView-submitting");b.style.height=f.getComputedStyle(a,
"height");h.add("item-remaining");h.add("submitting");a.innerHTML="";a.appendChild(b)}function B(a){a&&0<=a.indexOf("?")&&(a+="\x26ctx\x3dnav");return a}var y="click",g={ACTION:"data-action",ACTION_URL:"data-action-url",BACKFILL:"data-li-backfill",BACKFILL_URL:"data-li-backfill-url",SINCE:"data-li-since"},e={CLEAR_GEM:"clear-gem",CLOSE_CONFIRMATION:"close-confirmation",GEM:"gem",GEM_UNSEEN:"gem-unseen",INBOX_ITEM:"inbox-item",INBOX_ITEM_WONTON:"inbox-item-wonton",INBOX_LIST:"inbox-list",MESSAGE_ITEM:"message-item",
SINCE_DATE:"since-date",TOTAL_COUNT:"total-count",UNSEEN:"unseen",UNREAD:"unread",UNVIEWED:"unviewed"},D=["scripts/apps/chrome/remote-nav/consumer2/katy/modules/AjaxRequestQueue"],C="textContent"in document.body,q={},p,u,n;(function(){var a;p=a=document.getElementById("inbox-overlay-messages");u=c.querySelector(".message-count");a&&(q={messages:{backfill:!0,backfillUrl:a.getAttribute(g.BACKFILL_URL),sinceDate:a.getAttribute(g.SINCE)}},w.getScript(f.getJSpath(D),x))})()})})(window.globalNav);