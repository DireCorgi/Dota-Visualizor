(function(e){function v(a){var c=a.target,b=c.classList;b.contains(d.UNSUBSCRIBE_LINK)?(a.stopImmediatePropagation(),a.preventDefault(),a=f.closestAncestorWithClass(c,d.UPDATE),b=a.classList,b.remove(d.CAN_UNSUBSCRIBE),b.add(d.UNSUBSCRIBE_CONFIRM),r.call(this,a,c,{notification_ID:!0,notification_type:!0})):b.contains(d.UNSUBSCRIBE_CANCEL)?(a.stopImmediatePropagation(),a.preventDefault(),a=f.closestAncestorWithClass(c,d.UPDATE),b=a.classList,b.remove(d.UNSUBSCRIBE_CONFIRM),b.add(d.CAN_UNSUBSCRIBE),
r.call(this,a,c,{notification_ID:!0,notification_type:!0})):b.contains(d.UNSUBSCRIBE_ACTION)?(a.stopImmediatePropagation(),a.preventDefault(),w.call(this,c)):b.contains(d.NOTIFICATION_LINK)&&(a.preventDefault(),x.call(this,c))}function w(a){var c=f.closestAncestorWithClass(a,d.UPDATE),b=c.classList;n.ajax(a.getAttribute("href"),{type:"GET",dataType:"json",headers:{"X-IsAJAXForm":"1"}}).done(function(a){a&&a.content&&a.content.result===y&&(b.remove(d.UNSUBSCRIBE_CONFIRM),b.add(d.UNSUBSCRIBE_SUCCESS))});
r.call(this,c,a,{notification_ID:!0,notification_type:!0,position:!0,service_provider:!0,sub_ID:!0})}function x(a){var c=f.closestAncestorWithClass(a,d.UPDATE),b,c=t.call(this,c,z);this._config.markAsReadUrl?(b=function(){f.redirectToUrl(a.getAttribute("href"))},A.call(this,a,c).done(b,b)):s()&&p.trackBeforeNavigation(a.getAttribute(h.ACTION_TYPE),a.getAttribute("href"),c,!0)}function B(){var a=this,c=this._notifications.classList,b=this._notificationsList,l;this.backfillEnabled&&!c.contains(d.IS_BACKFILLING)&&
(c.add(d.IS_BACKFILLING),n.ajax(this._config.backfillUrl,{dataType:"json",data:{offset:this._notificationsBody.querySelectorAll("li."+d.UPDATE).length},headers:{"X-IsAJAXForm":"1"}}).done(function(g){var q,k,e,f;if(g&&g.status===C){l=document.createElement("div");l.innerHTML=g.content;l=l.firstChild;g=l.querySelectorAll("."+d.UPDATE);q=g.length;k=parseInt(l.getAttribute(h.NUM_REMAINING),10);if(0===k||0===q)a.backfillEnabled=!1;if(q){k=b.querySelector("li.loading");f=k.parentNode;for(e=0;e<q;e++)f.insertBefore(g[e],
k);b.querySelector("li."+d.LAST).classList.remove(d.LAST);g=b.querySelectorAll("li."+d.UPDATE);g[g.length-1].classList.add(d.LAST);a._dragonbars.redraw();a._scrollTopObserver.reset()}c.remove(d.IS_BACKFILLING)}}))}function D(){var a=this._notificationsList;this._dragonbars=new m.dependencies.DragonBars(a,{});this._scrollTopObserver=new m.dependencies.ScrollTopObserver(a,{});this.attachEventListeners()}function s(){return"undefined"!==typeof p}function A(a,c){var b="";s()&&(b=p.createRequestData(a.getAttribute(h.ACTION_TYPE),
c,!0),b+=["\x26readStatus\x3dtrue","\x26notificationId\x3d"+c.notification_ID].join(""));return n.ajax(this._config.markAsReadUrl,{type:"POST",data:b,headers:{"X-IsAJAXForm":"1"}})}function t(a,c){var b={},e,g,f,k;c.actor_count&&(b.actor_count=a.getAttribute(h.NUM_ACTORS));c.impression_ID&&(b.impression_ID=a.getAttribute(h.IMPRESSION_ID));c.isNew&&(b.isNew=a.classList.contains(d.SEEN));c.notification_ID&&(b.notification_ID=a.getAttribute(h.ID));c.notification_type&&(b.notification_type=a.getAttribute(h.TYPE));
c.service_provider&&(b.service_provider="on-site");c.sub_ID&&(b.sub_ID=a.getAttribute(h.SUB_ID));if(c.position)for(f=this._notificationsBody.querySelectorAll("li."+d.UPDATE),k=f.length,e=0;e<k;e++)if(g=f[e],g===a){b.position=++e;break}return b}function r(a,c,b){s()&&(a=t.call(this,a,b),p.trackUserAction(c.getAttribute(h.ACTION_TYPE),a,!0))}e=e.__internal__;var m=e.Injector,f=m.dependencies.Helpers,n=e.Request,p=m.dependencies.WebTracking;e=function(a){this._el=a;this._notifications=a.querySelector("."+
d.ACTIVITY_DROP);this._notificationsBody=a=a.querySelector("."+d.ACTIVITY_DROP_BODY);this._notificationsList=a.querySelector("ol");this._config={backfillIncrement:E,backfillUrl:a.getAttribute(h.BACKFILL_URL),markAsReadUrl:a.getAttribute(h.MARK_AS_READ_URL),dependencies:u};this.backfillEnabled=this._notificationsList.classList.contains(d.HAS_MORE)&&this._config.backfillUrl;n.getScript(f.getJSpath(u),D.bind(this))};var C="ok",y="SUCCESS",E=10,h={ACTION_TYPE:"data-li-action-type",BACKFILL_URL:"data-li-backfill-url",
ID:"data-li-id",IMPRESSION_ID:"data-li-impr-id",MARK_AS_READ_URL:"data-li-mark-as-read-url",NUM_ACTORS:"data-li-num-actors",NUM_REMAINING:"data-li-num-remaining",SUB_ID:"data-li-sub-id",TYPE:"data-li-type"},d={ACTIVITY_DROP:"activity-drop",ACTIVITY_DROP_BODY:"activity-drop-body",CAN_UNSUBSCRIBE:"can-unsubscribe",GEM:"gem",GEM_UNSEEN:"gem-unseen",HAS_MORE:"has-more",IS_BACKFILLING:"is-backfilling",LAST:"last",NOTIFICATION_LINK:"notification-link",SEEN:"seen",UPDATE:"update",UNSEEN:"unseen",UNSUBSCRIBE_ACTION:"unsubscribe-action",
UNSUBSCRIBE_CANCEL:"unsubscribe-cancel-action",UNSUBSCRIBE_CONFIRM:"unsubscribe-confirm",UNSUBSCRIBE_LINK:"unsubscribe-link",UNSUBSCRIBE_SUCCESS:"unsubscribe-success",UNVIEWED:"unviewed"},z={actor_count:!0,impression_ID:!0,isNew:!0,notification_ID:!0,notification_type:!0,position:!0,service_provider:!0,sub_ID:!0},u=["scripts/apps/chrome/remote-nav/consumer2/katy/modules/DragonBars","scripts/apps/chrome/remote-nav/consumer2/katy/modules/ScrollTopObserver"];e.prototype.attachEventListeners=function(){this._notificationsBody.addEventListener("click",
v.bind(this));this.backfillEnabled&&this._notificationsList.addEventListener(m.dependencies.ScrollTopObserver.EVENTS.DISTANCE_REACHED,B.bind(this))};m.register("NavNotificationsDropdown",e)})(window.globalNav);