(function(b){function i(b,c){for(var h in b)b.hasOwnProperty(h)&&(c[h]=b[h]);return c}function r(b,c,h,g){b.onload=b.onreadystatechange=function(){b.readyState&&"complete"!=b.readyState&&"loaded"!=b.readyState||c[h]||(b.onload=b.onreadystatechange=null,g())}}function E(b){b.ready=b.finished=!0;for(var c=0;c<b.finished_listeners.length;c++)b.finished_listeners[c]();b.ready_listeners=[];b.finished_listeners=[]}function z(){function q(b,c,s,q){var i,k,B=function(){c.ready_cb(c,function(){var f=i,h=function(){null!=
u&&(u=null,E(f))},u;y[c.src].finished||(b[t]||(y[c.src].finished=!0),u=f.elem||document.createElement("script"),c.type&&(u.type=c.type),c.charset&&(u.charset=c.charset),r(u,f,"finished",h),f.elem?f.elem=null:f.text?(u.onload=u.onreadystatechange=null,u.text=f.text):u.src=c.real_src,o.insertBefore(u,o.firstChild),f.text&&h())})},m=function(){c.finished_cb(c,s)};k=c.src;var l=b[g],A=/^\w+\:\/\//;/^\/\/\/?/.test(k)?k=location.protocol+k:!A.test(k)&&"/"!=k.charAt(0)&&(k=(l||"")+k);k=A.test(k)?k:("/"==
k.charAt(0)?w:j)+k;c.src=k;c.real_src=c.src+(b[h]?(/\?.*$/.test(c.src)?"&_":"?_")+~~(1E9*Math.random())+"=":"");y[c.src]||(y[c.src]={items:[],finished:!1});k=y[c.src].items;if(b[t]||0==k.length){var u=i=k[k.length]={ready:!1,finished:!1,ready_listeners:[B],finished_listeners:[m]},J=q?function(){i.ready=!0;for(var b=0;b<i.ready_listeners.length;b++)i.ready_listeners[b]();i.ready_listeners=[]}:function(){E(i)};setTimeout(function(){var f,h=c.real_src,k;if("item"in o){if(!o[0]){setTimeout(arguments.callee,
25);return}o=o[0]}f=document.createElement("script");c.type&&(f.type=c.type);c.charset&&(f.charset=c.charset);q?K?(b[p]&&n("start script preload: "+h),u.elem=f,Q?(f.preload=!0,f.onpreload=J):f.onreadystatechange=function(){f.readyState=="loaded"&&J()},f.src=h):q&&0==h.indexOf(w)&&b[C]?(k=new XMLHttpRequest,b[p]&&n("start script preload (xhr): "+h),k.onreadystatechange=function(){if(k.readyState==4){k.onreadystatechange=function(){};u.text=k.responseText+"\n//@ sourceURL="+h;J()}},k.open("GET",h),
k.send()):(b[p]&&n("start script preload (cache): "+h),f.type="text/cache-script",r(f,u,"ready",function(){o.removeChild(f);J()}),f.src=h,o.insertBefore(f,o.firstChild)):(F?(b[p]&&n("start script load (ordered async): "+h),f.async=!1):b[p]&&n("start script load: "+h),r(f,u,"finished",J),f.src=h,o.insertBefore(f,o.firstChild))},0)}else i=k[0],i.finished?m():i.finished_listeners.push(m)}function v(){function b(c,h){m[p]&&n("script preload finished: "+c.real_src);c.ready=!0;c.exec_trigger=h;g()}function h(b,
c){m[p]&&n("script execution finished: "+b.real_src);b.ready=b.finished=!0;b.exec_trigger=null;for(var k=0;k<c.scripts.length;k++)if(!c.scripts[k].finished)return;c.finished=!0;g()}function g(){for(;j<k.length;)if("[object Function]"==Object.prototype.toString.call(k[j])){m[p]&&n("$LAB.wait() executing: "+k[j]);try{k[j++]()}catch(b){m[p]&&c("$LAB.wait() error caught: ",b)}}else{if(!k[j].finished){for(var h=k[j],i=!1,f=0;f<h.scripts.length;f++)h.scripts[f].ready&&h.scripts[f].exec_trigger&&(i=!0,h.scripts[f].exec_trigger(),
h.scripts[f].exec_trigger=null);if(i)continue;break}j++}j==k.length&&(l=r=!1)}var o,m=i(s,{}),k=[],j=0,r=!1,l;o={script:function(){for(var c=0;c<arguments.length;c++){var g=arguments[c],j=arguments[c],f=void 0;"[object Array]"==Object.prototype.toString.call(g)||(j=[g]);for(var p=0;p<j.length;p++){if(!l||!l.scripts)k.push(l={scripts:[],finished:!0});g=j[p];"[object Function]"==Object.prototype.toString.call(g)&&(g=g());g&&("[object Array]"==Object.prototype.toString.call(g)?(f=[].slice.call(g),f.unshift(p,
1),[].splice.apply(j,f),p--):("string"==typeof g&&(g={src:g}),g=i(g,{ready:!1,ready_cb:b,finished:!1,finished_cb:h}),l.finished=!1,l.scripts.push(g),q(m,g,l,G&&r),r=!0,m[N]&&o.wait()))}}return o},wait:function(){if(0<arguments.length){for(var b=0;b<arguments.length;b++)k.push(arguments[b]);l=k[k.length-1]}else l=!1;g();return o}};return{script:o.script,wait:o.wait,setOptions:function(b){i(b,m);return o}}}var s={},G=K||Y,H=[],y={},I;s[C]=!0;s[N]=!1;s[t]=!1;s[h]=!1;s[p]=!1;s[g]="";return I={setGlobalDefaults:function(b){i(b,
s);return I},setOptions:function(){return v().setOptions.apply(null,arguments)},script:function(){return v().script.apply(null,arguments)},wait:function(){return v().wait.apply(null,arguments)},queueScript:function(){H[H.length]={type:"script",args:[].slice.call(arguments)};return I},queueWait:function(){H[H.length]={type:"wait",args:[].slice.call(arguments)};return I},runQueue:function(){for(var b=I,c=H.length,h;0<=--c;)h=H.shift(),b=b[h.type].apply(null,h.args);return b},noConflict:function(){b.$LAB=
m;return I},sandbox:function(){return z()}}}var m=b.$LAB,C="UseLocalXHR",N="AlwaysPreserveOrder",t="AllowDuplicates",h="CacheBust",p="Debug",g="BasePath",j=/^[^?#]*\//.exec(location.href)[0],w=/^\w+\:\/\/\/?[^\/]+/.exec(j)[0],o=document.head||document.getElementsByTagName("head"),s=b.opera&&"[object Opera]"==Object.prototype.toString.call(b.opera)||"MozAppearance"in document.documentElement.style,n=function(){},c=n,G=document.createElement("script"),Q="boolean"==typeof G.preload,K=Q||G.readyState&&
"uninitialized"==G.readyState,F=!K&&!0===G.async,Y=!K&&!F&&!s;b.console&&b.console.log&&(b.console.error||(b.console.error=b.console.log),n=function(c){b.console.log(c)},c=function(c,h){b.console.error(c,h)});b.$LAB=z();var y=void 0;null==document.readyState&&document.addEventListener&&(document.readyState="loading",y=y||function(){document.removeEventListener("DOMContentLoaded",y,false);document.readyState="complete"},document.addEventListener("DOMContentLoaded",y,!1))})(this);var JSON;JSON||(JSON={});
(function(){function b(b){return 10>b?"0"+b:b}function i(b){z.lastIndex=0;return z.test(b)?'"'+b.replace(z,function(b){var h=N[b];return"string"===typeof h?h:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function r(b,p){var g,j,w,o,s=m,n,c=p[b];c&&("object"===typeof c&&"function"===typeof c.toJSON)&&(c=c.toJSON(b));"function"===typeof t&&(c=t.call(p,b,c));switch(typeof c){case "string":return i(c);case "number":return isFinite(c)?String(c):"null";case "boolean":case "null":return String(c);case "object":if(!c)return"null";
m+=C;n=[];if("[object Array]"===Object.prototype.toString.apply(c)){o=c.length;for(g=0;g<o;g+=1)n[g]=r(g,c)||"null";w=0===n.length?"[]":m?"[\n"+m+n.join(",\n"+m)+"\n"+s+"]":"["+n.join(",")+"]";m=s;return w}if(t&&"object"===typeof t){o=t.length;for(g=0;g<o;g+=1)"string"===typeof t[g]&&(j=t[g],(w=r(j,c))&&n.push(i(j)+(m?": ":":")+w))}else for(j in c)Object.prototype.hasOwnProperty.call(c,j)&&(w=r(j,c))&&n.push(i(j)+(m?": ":":")+w);w=0===n.length?"{}":m?"{\n"+m+n.join(",\n"+m)+"\n"+s+"}":"{"+n.join(",")+
"}";m=s;return w}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var E=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
z=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,C,N={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;"function"!==typeof JSON.stringify&&(JSON.stringify=function(b,i,g){var j;C=m="";if(typeof g==="number")for(j=0;j<g;j=j+1)C=C+" ";else typeof g==="string"&&(C=g);if((t=i)&&typeof i!=="function"&&(typeof i!=="object"||typeof i.length!=="number"))throw Error("JSON.stringify");return r("",{"":b})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,i){function g(b,h){var j,m,c=b[h];if(c&&typeof c==="object")for(j in c)if(Object.prototype.hasOwnProperty.call(c,j)){m=g(c,j);m!==void 0?c[j]=m:delete c[j]}return i.call(b,h,c)}var j,b=String(b);E.lastIndex=0;E.test(b)&&(b=b.replace(E,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+b+")");return typeof i==="function"?g({"":j},""):j}throw new SyntaxError("JSON.parse");})})();window.fs=window.fs||{};var FS_VERSION="1.3.3";
(function(b,i,r){function E(a){a.willThrow="undefined"===typeof a.willThrow?!0:a.willThrow;p(a.id,l.RENDER);a.err.message||(a.err.message="Issue encountered during dust.render() call");x.warn(a.err.message);F({id:a.id,code:a.code,thrown:a.err,message:a.err.message});if(a.willThrow)throw a.err;}function z(a,R,d){var b={embed:f[a],modified:!1};if(b.embed)if(d!==q&&b.embed.constructor===q)b.embed=new d(R),Q(f[a],b.embed),f[a]=b.embed;else return b;else f[a]=b.embed=new d(R);b.modified=!0;return b}function m(){return new window.XMLHttpRequest}
function C(){return new window.ActiveXObject("Microsoft.XMLHTTP")}function N(a){a=-1!==a.indexOf("?")?a+"&":a+"?";return a+="_="+ +new Date}function t(a,b){var d;D[a]&&(d=g(a,b),d.fragmentStart=+new Date)}function h(a,b){var d=g(a,b),e;if(d&&(d.fragmentStart&&(d.total+=+new Date-d.fragmentStart,d.fragmentStart=0),!b||b===l.TOTAL))e=f[a],d=D[a],e.timings.parseProcessing=d.parseProcessing.total,e.timings.parse=d.parse.total,e.timings.renderProcessing=d.renderProcessing.total,e.timings.render=d.render.total,
d.scriptExternalEval.total=e.scriptExternalEval?d.scriptExternalEval.total-d.scriptInlineEval.total:0,e.timings.scriptExternalEval=d.scriptExternalEval.total,e.timings.scriptInlineEval=d.scriptInlineEval.total,e.timings.total=d.parseProcessing.total+d.parse.total+d.renderProcessing.total+d.render.total+d.scriptExternalEval.total+d.scriptInlineEval.total,e.timingComplete=!0,e.timingCallback&&e.timingCallback(e.timings),D[a]=null,delete D[a]}function p(a,b){var d=g(a,b);d&&(d.total=0,d.fragmentStart=
0)}function g(a,b){if(D[a])return b||(b=l.TOTAL),D[a][b]}function j(a,b,d){var e,c,g;t(a,l.RENDER_PROCESS);d&&((c=i.getElementById(d))||x.warn("No container node found with ID '",d,"', attempting to use id '",a,"' instead"));if(!c&&(e=i.getElementById(a),!e)){e="No reference script found with ID '"+a+"', cannot render";x.warn(e);p(a,l.RENDER_PROCESS);F({id:a,code:B.fizzyRender,message:e});return}d=i.createElement(ea);I?(d.innerHTML="_"+b,d.removeChild(d.firstChild)):d.innerHTML=b;b=i.createDocumentFragment();
g=d.getElementsByTagName(ca);if(!(g instanceof Array)){for(var k,j=0,m=[];k=g[j++];)m.push(k);g=m}k=f[a];for(D[a]&&r.queueWait(function(){t(a,l.SCRIPT_EXT_EVAL)});j=g.shift();)if(!j.type||ba.test(j.type))j.parentNode.removeChild(j),j.src?(!k.scriptExternalEval&&D[a]&&(k.scriptExternalEval=!0),r.queueScript(j.src).queueWait()):(j=j.text||j.textContent||j.innerHTML||"")&&r.queueWait(function(b){return function(){t(a,l.SCRIPT_INL_EVAL);(window.execScript||function(a){window.eval.call(window,a)})(b);
h(a,l.SCRIPT_INL_EVAL)}}(j));D[a]&&r.queueWait(function(){h(a,l.SCRIPT_EXT_EVAL)});for(k.scriptExternalEval&&r.queueWait(function(){h(a)});d.firstChild;)b.appendChild(d.firstChild);c?c.appendChild(b):e.parentNode.insertBefore(b,e);h(a,l.RENDER_PROCESS);r.runQueue()}function w(a,R){var d,e,c;t(a,l.PARSE_PROCESS);if(e=i.getElementById(a+da)){if(!e.firstChild||8!==e.firstChild.nodeType)return e="Payload content container for reference ID '"+a+"' was empty.",x.warn(e),p(a,l.PARSE_PROCESS),F({id:a,code:B.emptyPayloadNode,
message:e}),null;d=e.firstChild.nodeValue;(c=d.length)?(d=b.isUniEscapeOn()?R?b.unescape(d,!0):b.unescape(d,!1):b.unescape(d),e.parentNode.removeChild(e),h(a,l.PARSE_PROCESS),R&&(d=o(a,d))):(x.warn("Payload content container for reference ID '",a,"' had no content. You may not see any data for it's associated embed."),p(a,l.PARSE_PROCESS))}else d=b.payload(a),d||(e="Payload content for reference ID '"+a+"' not found in the DOM or the cache.",x.warn(e),F({id:a,code:B.payloadCacheMiss,message:e}));
return d}function o(a,b){var d;t(a,l.PARSE_PROCESS);0===b.indexOf("throw /*LI:DBE*/ 1;")&&(b=b.substring(19));h(a,l.PARSE_PROCESS);try{t(a,l.PARSE),d=JSON.parse(b),h(a,l.PARSE)}catch(e){throw e.message||(e.message="Malformed JSON encountered during parse"),x.warn(e.message),p(a,l.PARSE),F({id:a,code:B.jsonParse,message:e.message,thrown:e}),e;}return d}function s(a,b,d,e){for(var c in b)if(b.hasOwnProperty(c))if(e&&a.hasOwnProperty(c)&&b[c]+""===X&&a[c]+""===X)a[c]=s(a[c],b[c],d,!0);else if(!a.hasOwnProperty(c)||
d)a[c]=b[c];return a}function n(a,b){var d,e={};for(d in a)a.hasOwnProperty(d)&&(e[d]=b&&a[d]+""===X?n(a[d],!0):a[d]);return e}function c(a,b,d,e){var c=f[b]||new q({id:b}),g=c.events[a];f[b]=c;g.listeners.push({bubbleError:e,callback:d});if(g.fired)c[a]()}function G(a,b,d){var b=f[b],e;if(b){a=b.events[a];b=0;for(e=a.listeners.length;b<e;b++)if(a.listeners[b].callback===d){a.listeners.splice(b,1);break}}}function Q(a,b){if(a.constructor===q)for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d])}function K(a){if(a.id)if(a.callback)f[a.id]&&
f[a.id][a.customKey]&&!f[a.id][a.customKey].invoked?a.callback(a.id,f[a.id][a.customKey]):c(a.event,a.id,a.callback);else{if(f[a.id]&&f[a.id][a.customKey]&&!f[a.id][a.customKey].invoked)return f[a.id][a.customKey];x.warn("No custom embed found with id '",a.id,"', it may have already been invoked or was never registered.")}}function F(a){var b=f[P],d=f[a.id],a=new Y(a);b&&b.error(a);d&&b!==d&&d.error(a)}function Y(a){this.code=a.code;this.id=a.id;this.message=a.message;a.thrown&&(this.thrown=a.thrown);
if(a.xhrStatus||a.xhrContentType)this.xhr={status:a.xhrStatus,contentType:a.xhrContentType}}function y(a){var b=this;b[a.methodName]=function(){if(b.invoked)return!1;b.invoked=!0;a.method.apply(window,a.args);return!0}}function q(a){a&&(this.id=a.id,this.events={before:{fired:!1,listeners:[]},after:{fired:!1,listeners:[]},custom:{fired:!1,listeners:[]},xhr:{fired:!1,listeners:[]},xhrCustom:{fired:!1,listeners:[]},error:{fired:!1,listeners:[]}},a.xhrObj&&(this.xhrObj=a.xhrObj),a.args&&(a.embedFunc?
this.initCustom(a):a.xhrFunc&&this.initCustomXHR(a)),(a.recordTimings||U)&&this.recordTimings())}function v(a){a&&(this.super_.call(this,a),this.templateId=a.templateId,this.context=a.context)}function M(a){a&&(this.super_.call(this,a),this.context=a.context)}function Z(a,b){var d=function(){};d.prototype=a.prototype;b.prototype=new d;b.prototype.constructor=b;b.prototype.super_=a}var H=FS_VERSION,ea="div",I="Microsoft Internet Explorer"===window.navigator.appName,ba=/(text|application)\/(java|ecma)script/i,
ca=i.createElement("script").nodeName.toLowerCase(),da="-content",P="__*__",X="[object Object]",k={xhrHeaders:{"X-Requested-With":"XMLHttpRequest","X-FS-Embed-Fetch":1},failureRedirect:""},B={payloadCacheMiss:601,emptyPayloadNode:602,dustRender:603,dustChunk:604,missingTemplate:605,fizzyRender:606,xhrStatus:607,xhrContentType:608,jsonParse:609},$={error:1},l={PARSE_PROCESS:"parseProcessing",PARSE:"parse",RENDER_PROCESS:"renderProcessing",RENDER:"render",SCRIPT_EXT_EVAL:"scriptExternalEval",SCRIPT_INL_EVAL:"scriptInlineEval",
TOTAL:"total"},A=k,u=Array.prototype.push,J=Array.prototype.slice,f={},T=[],S=[],V={},W,D={},aa=(window.jstestdriver?window.jstestdriver.console:window.console)||{warn:function(){var a=J.call(arguments,0);window.alert(a.join(" "))}},U;a:{var L=window.location.search.split("&"),ha=0,O;for(L[0]=L[0].replace("?","");O=L[ha++];)if(O=-1===O.indexOf("=")?O:O.split("=")[0],"fzDebug"===O){U=!0;break a}U=!1}var x={warn:function(){U&&window.FZ_DBG&&aa.warn.apply(aa,arguments)}},L={};window.FS_VERSION=void 0;
try{delete window.FS_VERSION}catch(ia){}b.config=function(a){a&&s(A,a,!0,!0);return n(A,!0)};b.timing=function(a,b){var d=z(a,{id:a,recordTimings:!0},q),e=d.embed;!d.modified&&!e.timings&&e.recordTimings();e.timingComplete?b(e.timings):e.timingCallback=b};b.isUniEscapeOn=function(){return!!A.uniEscape};b.setUniEscape=function(a){A.uniEscape=a};b.unescape=function(a,c){return b.isUniEscapeOn()?c?a.replace(RegExp("\\\\u002d","gi"),"-"):a.replace(RegExp("&#45;","gi"),"-").replace(RegExp("&amp;","gi"),
"&"):a.replace(RegExp("&dsh;","gi"),"-").replace(RegExp("&amp;","gi"),"&")};b.escape=function(a,c){return b.isUniEscapeOn()?c?a.replace(RegExp("-","gi"),"\\u002d"):a.replace(RegExp("&","gi"),"&amp;").replace(RegExp("-","gi"),"&#45;"):a.replace(RegExp("&","gi"),"&amp;").replace(RegExp("-","gi"),"&dsh;")};b.dupe=function(a,c,d,e){var g=w(c,!0);if(g)return f[c]?f[c].context=g:f[c]=new v({id:c,context:g}),b.embed(a,d,g,e);x.warn("No cached embed data located for template '",d,"' and reference ID '",a,
"', the embed dependency with reference ID '",c,"' may not have rendered correctly due to invalid or missing data")};b.embed=function(a,b,d,e){var c;t(a);if(!d&&(d=w(a,!0),!d))return;(c=f[a])?c.constructor===q?(c=new v({id:a,templateId:b,context:d}),Q(f[a],c),f[a]=c):(c.templateId=b,c.context=d):f[a]=c=new v({id:a,templateId:b,context:d});c.before();if(dust.cache[b]){t(a,l.RENDER);try{dust.render(b,c.context.content||c.context,function(b,d){b&&E({id:a,err:b,code:B.dustChunk});h(a,l.RENDER);j(a,d,
e);c.scriptExternalEval||h(a);c.after()})}catch(g){E({id:a,err:g,code:B.dustRender})}}else b=Error("No template found in the cache with ID '"+b+"' for embed with ID '"+a+"'"),x.warn(b.message),E({id:a,err:b,code:B.missingTemplate})};b.embedHTML=function(a,b,d,c){var f;if(b=b||w(a,c))f=z(a,{id:a,context:b},M),c=f.embed,f.modified||(c.context=b),c.before(),j(a,b,d),c.scriptExternalEval||h(a),c.after()};b.after=function(a,b,d){c("after",a,b,d)};b.before=function(a,b,d){c("before",a,b,d)};b.xhr=function(a,
b,d){c("xhr",a,b,d)};b.on=function(a,b,d,e){a in $&&("function"===typeof b&&(d=b,b=P),e=!1);c(a,b,d,e)};b.cancel=function(a,b,d){a in $&&"function"===typeof b&&(d=b,b=P);G(a,b,d)};b.js=function(){u.apply(S,arguments)};b.fetch=function(){for(var a;a=S.shift();)r.queueScript(a).queueWait();r.runQueue()};b.custom=function(a,b){return K({id:a,callback:b,customKey:"customEmbed",event:"custom"})};b.setCustom=function(a,c){var d,e,f;if(a&&c){e={id:a};switch(c.type){case "json":d=v;e.context=c.data;e.embedFunc=
b.embed;e.args=[a,c.templateId,c.data,c.container];break;case "html":d=M;e.context=c.data;e.embedFunc=b.embedHTML;e.args=[a,c.data,c.container];break;case "dupe":d=v;e.context=c.data;e.embedFunc=b.dupe;e.args=[a,c.dupeId,c.templateId,c.container];break;default:x.warn("Unknown embed type '"+c.type+"' specified for embed with ID '"+a+"', embed types must be 'json', 'html', or 'dupe'");return}f=z(a,e,d);d=f.embed;f.modified||(d.constructor===v&&(d.templateId=e.templateId),d.context=e.context,d.initCustom(e));
d.custom();return d.customEmbed}};b.embedXHR=function(a,f){var d,e;if(a){e={renderControl:"immediate",wait:!1,timeout:3E4};d={};s(e,f,!0);"server"===e.renderControl&&(d.Accept="text/html");s(d,A.xhrHeaders);var g=e.url,j=function(d,c){var f,g,i,j,h,k,l;h=c?504:d.status;g=z(a,{id:a,xhrObj:{status:h}},v);f=g.embed;if(!g.modified)f.xhrObj={status:h};if(!c)f.errorMsg=d.getResponseHeader("X-FS-Embed-Error");f.xhr();if(h===200||h===204){h=d.getResponseHeader("Content-Type");if(h.indexOf("json")!==-1){if(d.getResponseHeader("X-FS-Template-Keys")&&
d.getResponseHeader("X-FS-Template-Keys").length){h=d.getResponseHeader("X-FS-Template-Keys").split(",");g={};var m,n;for(l=0;l<h.length;l++){m=h[l].replace(/\s/g,"");if(m.length){n=m.split("=");m=n[0].replace(/\s/g,"");m.length&&n[1].length&&(g[m]=n[1])}}i=g}else i={};j=i[e.templateId]||e.templateId||i.__default__;h=e.renderControl==="custom"?function(){b.setCustom(a,{templateId:j,data:o(a,d.responseText),type:"json",container:e.container})}:function(){b.embed(a,j,o(a,d.responseText),e.container)};
if(d.getResponseHeader("X-FS-Batch-Status")){k={};g=d.getResponseHeader("X-FS-Batch-Status").split(",");l=function(a){a=a.split("=");k[a[0]]={status:a[1],templateKey:i[a[0]]}};if(Array.prototype.forEach)Array.prototype.forEach.call(g,l);else{m=0;do l(g[m],m,g);while(g[++m])}if(i.__default__)k.__default__={status:200,templateKey:i.__default__};f.batch=k}if(d.getResponseHeader("X-FS-TL")&&d.getResponseHeader("X-FS-TL").length){f=d.getResponseHeader("X-FS-TL").split(",");l=0;do{g=f[l].replace(/\s/g,
"");g.length&&r.queueScript(f[l])}while(f[++l])}r.queueWait(h).runQueue()}else if(h.indexOf("html")!==-1)e.renderControl==="custom"?b.setCustom(a,{data:d.responseText,type:"html",container:e.container}):b.embedHTML(a,d.responseText,e.container);else{h="Unknown Content-Type '"+h+"' received for XHR embed with ID '"+a+"' and URL '"+e.url+"'";x.warn(h);F({id:a,code:B.xhrContentType,message:h})}}else{h="Unsuccessful status code '"+h+"' received for XHR embed with ID '"+a+"' and URL '"+e.url+"'";x.warn(h);
F({id:a,code:B.xhrStatus,message:h});e.required&&b.redirect(f.errorMsg,A.failureRedirect)}},h=e.timeout,k=e.cache,i,l,p,n;if(!W)try{i=m(),W=m}catch(q){i=C(),W=C}T.length?i=T.pop():i||(i=W());i.open("GET",k?g:N(g),!0);for(l in d)d.hasOwnProperty(l)&&i.setRequestHeader(l,d[l]);i.onreadystatechange=function(){if(p)j(i,true);else{if(i.readyState!==4)return;if(n){window.clearTimeout(n);n=null}j(i,false)}i.onreadystatechange=null;T.push(i)};i.send(null);0<h&&(n=window.setTimeout(function(){p=true;i.abort()},
h));e.callback&&c("xhr",a,e.callback)}};b.dupeXHR=function(a,c,d){V[a]||(V[a]=1,d=d||{},b.xhr(c,function(c,g){var h=f[c],i,j,k;200===g.status||204===g.status?(i=function(c){var e,f;e=h.batch[d.templateId]||h.batch.__default__;f=parseInt(e.status,10);200===f||204===f?!d.renderControl||"immediate"===d.renderControl?b.dupe(a,c,e.templateKey,d.container):"custom"===d.renderControl?b.setCustom(a,{dupeId:c,templateId:e.templateKey,container:d.container,type:"dupe"}):x.warn("Unknown embed type '"+d.type+
"' specified for embed with ID '"+a+"', embed types must be 'json', 'html', or 'dupe'"):d.required&&b.redirect(h.errorMsg,A.failureRedirect);delete V[a]},j=function(){i.apply(window,arguments);G("after",c,k)},k=function(){i.apply(window,arguments);G("error",c,j)},b.on("error",c,j,!0),b.after(c,k,!0)):d.required&&(b.redirect(h.errorMsg,A.failureRedirect),delete V[a])},!0))};b.customXHR=function(a,b){return K({id:a,callback:b,customKey:"customXHR",event:"xhrCustom"})};L.setCustomXHR=function(a,c){var d,
e,f;a&&c&&(e={id:a,args:[a,c],xhrFunc:b.embedXHR},d=c.templateId?v:M,f=z(a,e,d),d=f.embed,f.modified||(d.constructor===v&&(d.templateId=e.templateId),d.initCustomXHR(e)),d.xhrCustom())};b.redirect=function(a,c,d){var e,f;a?(-1!==c.indexOf("?")?"?"!==c[c.length-1]&&"&"!==c[c.length-1]&&(c+="&"):c+="?",0===a.indexOf("&")&&(a=a.substring(1)),f=c+a):f=c;0!==f.indexOf("http://")&&0!==f.indexOf("https://")&&(f="http://"+f);b.isUniEscapeOn()||(f=f.replace(RegExp("&quot;","gi"),'"').replace(RegExp("&squo;",
"gi"),"'"));if(d)return f;i.addEventListener?(e=function fa(){i.removeEventListener("DOMContentLoaded",fa,false);window.location.href=f},i.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):i.attachEvent&&(e=function ga(){i.detachEvent("onreadystatechange",ga);window.location.href=f},i.attachEvent("onreadystatechange",e),window.attachEvent("onload",e));if("complete"===i.readyState)return setTimeout(e,1)};b.payload=function(a){return f[a]?f[a].context:void 0};b.reset=function(){T=
[];S=[];f={};D={};S=[];A=n(k,!0);window.$LAB=r=r.sandbox()};b.version=function(){return H};b._server=L;L.fire=function(a,b){if(b&&f[a])f[a][b.event]()};q.prototype.initCustom=function(a){this.customEmbed=new y({methodName:"embed",method:a.embedFunc,args:a.args})};q.prototype.initCustomXHR=function(a){this.customXHR=new y({methodName:"xhr",method:a.xhrFunc,args:a.args})};q.prototype.recordTimings=function(){this.timings={parseProcessing:0,parse:0,renderProcessing:0,render:0,scriptExternalEval:0,scriptInlineEval:0,
total:0};this.timingCallback=void 0;D[this.id]={parseProcessing:{total:0,fragmentStart:0},parse:{total:0,fragmentStart:0},renderProcessing:{total:0,fragmentStart:0},render:{total:0,fragmentStart:0},scriptExternalEval:{total:0,fragmentStart:0},scriptInlineEval:{total:0,fragmentStart:0},total:{total:0,fragmentStart:0}};this.timingComplete=this.scriptExternalEval=!1};q.prototype.fire=function(a,b){var c,e,f=[];if(a.listeners.length){e=this.id!==P?[this.id]:[];for(u.apply(e,b);c=a.listeners.shift();)try{c.callback.apply(window,
e),this.id===P&&f.push(c)}catch(g){if(x.warn("Callback ",(c.callback?c.callback:"[no callback given]")+" ","threw error '",g,"'"),c.bubbleError)throw g;}a.listeners=f}a.fired=!0};q.prototype.after=function(){this.fire.call(this,this.events.after,arguments)};q.prototype.before=function(){this.fire.call(this,this.events.before,arguments)};q.prototype.error=function(){this.fire.call(this,this.events.error,arguments)};q.prototype.custom=function(){this.fire.call(this,this.events.custom,[this.customEmbed])};
q.prototype.xhr=function(){this.fire.call(this,this.events.xhr,[this.xhrObj])};q.prototype.xhrCustom=function(){this.fire.call(this,this.events.xhrCustom,[this.customXHR])};Z(q,v);v.prototype.after=function(){this.super_.prototype.after.call(this,this.context)};v.prototype.before=function(){this.super_.prototype.before.call(this,this.context)};Z(q,M);M.prototype.after=function(){this.super_.prototype.after.call(this,this.context)};M.prototype.before=function(){this.super_.prototype.before.call(this,
this.context)}})(window.fs,window.document,window.$LAB);
